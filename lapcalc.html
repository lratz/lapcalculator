<html lang="en">
	<head id="header">
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <meta charset="UTF-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
		<title>CALTAF Lap Calculator</title>

	  <script type="text/javascript">
      function get_m(d_in, u_in){
        var d_out = 0;
        switch(u_in){
          case "km":
            d_out = d_in*1000;
            break;
          case "m":
            d_out = d_in*1;
            break;
          case "mi":
            d_out = d_in*1609.344;
            break;
          case "ft":
            d_out = d_in*0.3048;
            break;
          case "pc":
            d_out = d_in*30856780000000000;
            break;
        }
        return d_out;

      }
      function pad(n, width, z) {
        z = z || '0';
        n = n + '';
        return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
      }
  	  $(document).ready(function() {

        $('.selection.dropdown')
          .dropdown()
        ;

        $('form.form')
          .form({
              fields: {
                goal_distance      : 'decimal',
                goaldistanceunits  : 'empty',
                splitdistanceunits : 'empty',
                split_distance     : 'decimal'
              }
            })
          .form("add fields", {
              goal_hours: {
                identifier : 'goal_hours',
                optional   : true,
                rules: [{
                    type   : 'decimal',
                    prompt : '{name} should be a number or empty'
                  }]
              },
              goal_minutes: {
                identifier : 'goal_minutes',
                optional   : true,
                rules: [{
                    type   : 'decimal',
                    prompt : '{name} should be a number or empty'
                  }]
              },
              goal_seconds: {
                identifier : 'goal_seconds',
                optional   : true,
                rules: [{
                    type   : 'decimal',
                    prompt : '{name} should be a number or empty'
                  }]
              }
        }).api({
          beforeSend: function(settings){
            var f = $('form.form');
            var h = parseFloat(f.form("get value", "goal_hours"));
            var m = parseFloat(f.form("get value", "goal_minutes"));
            var s = parseFloat(f.form("get value", "goal_seconds"));
            var dg = parseFloat(f.form("get value", "goal_distance"));
            var ds = parseFloat(f.form("get value", "split_distance"));
            var total_time = 0;
            var dg_m = 0;
            var ds_m = 0;
            var s_p_m = 0;
            var split_time_total = 0;
            var split_hours = 0;
            var split_minutes = 0;
            var split_seconds = 0;
            var split_string = "";


            if (isNaN(h) && isNaN(m) && isNaN(s) ){
              f.form("add errors", ["At least one of Hours, Minutes, Seconds has to be filled"]);
              return false;
            }
            if(!isNaN(h)) total_time +=  h*3600;
            if(!isNaN(m)) total_time +=  m*60;
            if(!isNaN(s)) total_time +=  s;

            dg_m = get_m(dg, f.form("get value", "goaldistanceunits"));
            ds_m = get_m(ds, f.form("get value", "splitdistanceunits"));

            s_p_m = total_time/dg_m;
            split_time_total = s_p_m * ds_m;

            split_hours = Math.floor(split_time_total / 3600);
            split_time_total %= 3600;
            split_minutes = Math.floor(split_time_total / 60);
            split_seconds = split_time_total % 60;

            if(split_hours > 0) split_string = split_hours + ":";
            if(split_minutes > 0) split_string +=
            split_minutes.toLocaleString('en', {minimumIntegerDigits:2,minimumFractionDigits:0,useGrouping:false}) + ":";

            split_string += split_seconds.toLocaleString('en', {minimumIntegerDigits:2,minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:false});

            $('.ui.statistic .value').text(split_string + "");
            $('.ui.statistic .label').text("per "+ f.form("get value", "split_distance")+f.form("get value", "splitdistanceunits"));

            if(! $('.ui.transition').transition('is visible')) {
              $('.ui.transition').transition('drop');
            }

            return false;
          }
        });

        $('.button.reset').click(function(e){
          if($('.ui.transition').transition('is visible')){
            $('.ui.transition').transition('drop');
          }
        });


  	  });
	  </script>
	</head>
	<body>
    <div class="ui main container">
  		<div class="ui masthead vertical segment">
  			<div class="ui container">
  				<div class="introduction">
  					<h1 class="ui header">
  					       CALTAF Lap Calculator
  					<div class="sub header">Caclutate laps or splits for various races</div>
  					</h1>
  				</div>

  			</div>
  		</div>
      <div class="ui segment">

        <form class="ui form">
          <h4 class="ui dividing header">Goal Performance</h4>
          <div class="three fields">
            <div class="field">
              <label>Hours</label>
              <input type="text" name="goal_hours"  placeholder="hh">
            </div>
            <div class="field">
              <label>Minutes</label>
              <input type="text" name="goal_minutes" placeholder="mm">
            </div>
            <div class="field">
              <label>Seconds</label>
              <input type="text" name="goal_seconds" placeholder="ss.ss">
            </div>
          </div>
          <div class="two fields">
          <div class="field">
            <label>Race Distance</label>
            <input type="text" name="goal_distance" placeholder="15" value="10">
          </div>
          <div class="field">
            <label>Distance Units</label>
            <div class="ui selection dropdown">
              <input type="hidden" name="goaldistanceunits" value="km">
              <div class="text">km</div>
              <i class="dropdown icon"></i>
              <div class="menu">
                  <div class="item" data-value="km">km</div>
                  <div class="item" data-value="m">m</div>
                  <div class="item" data-value="mi">mile</div>
                  <div class="item" data-value="ft">ft</div>
                  <div class="item" data-value="pc">parsec</div>
              </div>
            </div>
          </div>
          </div>
          <h4 class="ui dividing header">Split Distance</h4>
          <div class="two fields">
            <div class="field">
              <label>Split Distance</label>
              <input type="text" name="split_distance" placeholder="400" value="1">
            </div>
            <div class="field">
              <label>Split Distance Units</label>
              <div class="ui selection dropdown">
                <input type="hidden" name="splitdistanceunits" value="km">
                <div class="text">km</div>
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="item" data-value="km">km</div>
                    <div class="item" data-value="m">m</div>
                    <div class="item" data-value="mi">mile</div>
                    <div class="item" data-value="ft">ft</div>
                    <div class="item" data-value="pc">parsec</div>
                </div>
              </div>
            </div>
          </div>
          <div class="ui error message"></div>
          <div class="ui primary submit button">Submit</div>
          <div class="ui reset button">Clear</div>
        </form>
      </div>
      <div class="ui transition hidden segment ">
        <div class="ui centered grid">
          <div class="row">
            <div class="ui statistic">
              <div class="value">
                1
              </div>
              <div class="label">
                per km
              </div>
            </div>
          </div>
        </div>
      </div>



    </div>

		<div id="footer">
			<div class="ui divider"></div>
		  <div class="ui center aligned container">
				<div class="ui divided horizontal footer link list">
					<div class="item">
						caltaf.ca
					</div>
					<div class="item">
						<a href="https://caltaf.ca"><i class="sun icon"></i></a>
					</div>
				</div>
			</div>
	  </div>

  </body>
</html>
